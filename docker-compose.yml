# Docker Compose configuration for local development
version: '3.8'

services:
	web:
		build:
			context: ./apps/web
		ports:
			- "3000:80"
		env_file:
			- .env.example
		depends_on:
			- api
		healthcheck:
			test: ["CMD-SHELL", "curl -f http://127.0.0.1/health || exit 1"]
			interval: 10s
			timeout: 5s
			retries: 3
			start_period: 5s

	api:
		build:
			context: ./apps/api
		ports:
			- "8000:8000"
		env_file:
			- .env.example
		restart: unless-stopped
		healthcheck:
			test: ["CMD-SHELL", "python -c \"import urllib.request,sys;\ntry:\n r=urllib.request.urlopen('http://127.0.0.1:8000/health', timeout=5)\n sys.exit(0 if r.getcode()==200 else 1)\nexcept:\n sys.exit(1)\n\""]
			interval: 10s
			timeout: 5s
			retries: 5
			start_period: 5s

# Notes:
# - For a simple local setup the AI code can run inside the API container.
# - Use `docker compose up --build` to start everything.